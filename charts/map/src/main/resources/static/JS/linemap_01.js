var city_line = [{"name":"北京市-天津市","line":["116.407394,39.904211","117.200983,39.084158"]},{"name":"北京市-河北省","line":["116.407394,39.904211","114.530235,38.037433"]},{"name":"北京市-山西省","line":["116.407394,39.904211","112.562678,37.873499"]},{"name":"北京市-内蒙古自治区","line":["116.407394,39.904211","111.76629,40.81739"]},{"name":"北京市-辽宁省","line":["116.407394,39.904211","123.431382,41.836175"]},{"name":"北京市-吉林省","line":["116.407394,39.904211","125.32568,43.897016"]},{"name":"北京市-黑龙江省","line":["116.407394,39.904211","126.661665,45.742366"]},{"name":"北京市-上海市","line":["116.407394,39.904211","121.473662,31.230372"]},{"name":"北京市-江苏省","line":["116.407394,39.904211","118.762765,32.060875"]},{"name":"北京市-浙江省","line":["116.407394,39.904211","120.152585,30.266597"]},{"name":"北京市-安徽省","line":["116.407394,39.904211","117.329949,31.733806"]},{"name":"北京市-福建省","line":["116.407394,39.904211","119.295143,26.100779"]},{"name":"北京市-江西省","line":["116.407394,39.904211","115.81635,28.63666"]},{"name":"北京市-山东省","line":["116.407394,39.904211","117.019915,36.671156"]},{"name":"北京市-河南省","line":["116.407394,39.904211","113.753394,34.765869"]},{"name":"北京市-湖北省","line":["116.407394,39.904211","114.341745,30.546557"]},{"name":"北京市-湖南省","line":["116.407394,39.904211","112.9836,28.112743"]},{"name":"北京市-广东省","line":["116.407394,39.904211","113.26641,23.132324"]},{"name":"北京市-广西壮族自治区","line":["116.407394,39.904211","108.327546,22.815478"]},{"name":"北京市-海南省","line":["116.407394,39.904211","110.349228,20.017377"]},{"name":"北京市-重庆市","line":["116.407394,39.904211","106.551643,29.562849"]},{"name":"北京市-四川省","line":["116.407394,39.904211","104.075809,30.651239"]},{"name":"北京市-贵州省","line":["116.407394,39.904211","106.70546,26.600055"]},{"name":"北京市-云南省","line":["116.407394,39.904211","102.710002,25.045806"]},{"name":"北京市-西藏自治区","line":["116.407394,39.904211","91.117525,29.647535"]},{"name":"北京市-陕西省","line":["116.407394,39.904211","108.954347,34.265502"]},{"name":"北京市-甘肃省","line":["116.407394,39.904211","103.826447,36.05956"]},{"name":"北京市-青海省","line":["116.407394,39.904211","101.780268,36.620939"]},{"name":"北京市-宁夏回族自治区","line":["116.407394,39.904211","106.259126,38.472641"]},{"name":"北京市-新疆维吾尔自治区","line":["116.407394,39.904211","87.627704,43.793026"]},{"name":"北京市-台湾省","line":["116.407394,39.904211","121.509062,25.044332"]},{"name":"北京市-香港特别行政区","line":["116.407394,39.904211","114.171203,22.277468"]},{"name":"北京市-澳门特别行政区","line":["116.407394,39.904211","113.543028,22.186835"]},{"name":"上海市-北京市","line":["121.473662,31.230372","116.407394,39.904211"]},{"name":"上海市-天津市","line":["121.473662,31.230372","117.200983,39.084158"]},{"name":"上海市-河北省","line":["121.473662,31.230372","114.530235,38.037433"]},{"name":"上海市-山西省","line":["121.473662,31.230372","112.562678,37.873499"]},{"name":"上海市-内蒙古自治区","line":["121.473662,31.230372","111.76629,40.81739"]},{"name":"上海市-辽宁省","line":["121.473662,31.230372","123.431382,41.836175"]},{"name":"上海市-吉林省","line":["121.473662,31.230372","125.32568,43.897016"]},{"name":"上海市-黑龙江省","line":["121.473662,31.230372","126.661665,45.742366"]},{"name":"上海市-江苏省","line":["121.473662,31.230372","118.762765,32.060875"]},{"name":"上海市-浙江省","line":["121.473662,31.230372","120.152585,30.266597"]},{"name":"上海市-安徽省","line":["121.473662,31.230372","117.329949,31.733806"]},{"name":"上海市-福建省","line":["121.473662,31.230372","119.295143,26.100779"]},{"name":"上海市-江西省","line":["121.473662,31.230372","115.81635,28.63666"]},{"name":"上海市-山东省","line":["121.473662,31.230372","117.019915,36.671156"]},{"name":"上海市-河南省","line":["121.473662,31.230372","113.753394,34.765869"]},{"name":"上海市-湖北省","line":["121.473662,31.230372","114.341745,30.546557"]},{"name":"上海市-湖南省","line":["121.473662,31.230372","112.9836,28.112743"]},{"name":"上海市-广东省","line":["121.473662,31.230372","113.26641,23.132324"]},{"name":"上海市-广西壮族自治区","line":["121.473662,31.230372","108.327546,22.815478"]},{"name":"上海市-海南省","line":["121.473662,31.230372","110.349228,20.017377"]},{"name":"上海市-重庆市","line":["121.473662,31.230372","106.551643,29.562849"]},{"name":"上海市-四川省","line":["121.473662,31.230372","104.075809,30.651239"]},{"name":"上海市-贵州省","line":["121.473662,31.230372","106.70546,26.600055"]},{"name":"上海市-云南省","line":["121.473662,31.230372","102.710002,25.045806"]},{"name":"上海市-西藏自治区","line":["121.473662,31.230372","91.117525,29.647535"]},{"name":"上海市-陕西省","line":["121.473662,31.230372","108.954347,34.265502"]},{"name":"上海市-甘肃省","line":["121.473662,31.230372","103.826447,36.05956"]},{"name":"上海市-青海省","line":["121.473662,31.230372","101.780268,36.620939"]},{"name":"上海市-宁夏回族自治区","line":["121.473662,31.230372","106.259126,38.472641"]},{"name":"上海市-新疆维吾尔自治区","line":["121.473662,31.230372","87.627704,43.793026"]},{"name":"上海市-台湾省","line":["121.473662,31.230372","121.509062,25.044332"]},{"name":"上海市-香港特别行政区","line":["121.473662,31.230372","114.171203,22.277468"]},{"name":"上海市-澳门特别行政区","line":["121.473662,31.230372","113.543028,22.186835"]},{"name":"广东省-北京市","line":["113.26641,23.132324","116.407394,39.904211"]},{"name":"广东省-天津市","line":["113.26641,23.132324","117.200983,39.084158"]},{"name":"广东省-河北省","line":["113.26641,23.132324","114.530235,38.037433"]},{"name":"广东省-山西省","line":["113.26641,23.132324","112.562678,37.873499"]},{"name":"广东省-内蒙古自治区","line":["113.26641,23.132324","111.76629,40.81739"]},{"name":"广东省-辽宁省","line":["113.26641,23.132324","123.431382,41.836175"]},{"name":"广东省-吉林省","line":["113.26641,23.132324","125.32568,43.897016"]},{"name":"广东省-黑龙江省","line":["113.26641,23.132324","126.661665,45.742366"]},{"name":"广东省-上海市","line":["113.26641,23.132324","121.473662,31.230372"]},{"name":"广东省-江苏省","line":["113.26641,23.132324","118.762765,32.060875"]},{"name":"广东省-浙江省","line":["113.26641,23.132324","120.152585,30.266597"]},{"name":"广东省-安徽省","line":["113.26641,23.132324","117.329949,31.733806"]},{"name":"广东省-福建省","line":["113.26641,23.132324","119.295143,26.100779"]},{"name":"广东省-江西省","line":["113.26641,23.132324","115.81635,28.63666"]},{"name":"广东省-山东省","line":["113.26641,23.132324","117.019915,36.671156"]},{"name":"广东省-河南省","line":["113.26641,23.132324","113.753394,34.765869"]},{"name":"广东省-湖北省","line":["113.26641,23.132324","114.341745,30.546557"]},{"name":"广东省-湖南省","line":["113.26641,23.132324","112.9836,28.112743"]},{"name":"广东省-广西壮族自治区","line":["113.26641,23.132324","108.327546,22.815478"]},{"name":"广东省-海南省","line":["113.26641,23.132324","110.349228,20.017377"]},{"name":"广东省-重庆市","line":["113.26641,23.132324","106.551643,29.562849"]},{"name":"广东省-四川省","line":["113.26641,23.132324","104.075809,30.651239"]},{"name":"广东省-贵州省","line":["113.26641,23.132324","106.70546,26.600055"]},{"name":"广东省-云南省","line":["113.26641,23.132324","102.710002,25.045806"]},{"name":"广东省-西藏自治区","line":["113.26641,23.132324","91.117525,29.647535"]},{"name":"广东省-陕西省","line":["113.26641,23.132324","108.954347,34.265502"]},{"name":"广东省-甘肃省","line":["113.26641,23.132324","103.826447,36.05956"]},{"name":"广东省-青海省","line":["113.26641,23.132324","101.780268,36.620939"]},{"name":"广东省-宁夏回族自治区","line":["113.26641,23.132324","106.259126,38.472641"]},{"name":"广东省-新疆维吾尔自治区","line":["113.26641,23.132324","87.627704,43.793026"]},{"name":"广东省-台湾省","line":["113.26641,23.132324","121.509062,25.044332"]},{"name":"广东省-香港特别行政区","line":["113.26641,23.132324","114.171203,22.277468"]},{"name":"广东省-澳门特别行政区","line":["113.26641,23.132324","113.543028,22.186835"]},{"name":"四川省-北京市","line":["104.075809,30.651239","116.407394,39.904211"]},{"name":"四川省-天津市","line":["104.075809,30.651239","117.200983,39.084158"]},{"name":"四川省-河北省","line":["104.075809,30.651239","114.530235,38.037433"]},{"name":"四川省-山西省","line":["104.075809,30.651239","112.562678,37.873499"]},{"name":"四川省-内蒙古自治区","line":["104.075809,30.651239","111.76629,40.81739"]},{"name":"四川省-辽宁省","line":["104.075809,30.651239","123.431382,41.836175"]},{"name":"四川省-吉林省","line":["104.075809,30.651239","125.32568,43.897016"]},{"name":"四川省-黑龙江省","line":["104.075809,30.651239","126.661665,45.742366"]},{"name":"四川省-上海市","line":["104.075809,30.651239","121.473662,31.230372"]},{"name":"四川省-江苏省","line":["104.075809,30.651239","118.762765,32.060875"]},{"name":"四川省-浙江省","line":["104.075809,30.651239","120.152585,30.266597"]},{"name":"四川省-安徽省","line":["104.075809,30.651239","117.329949,31.733806"]},{"name":"四川省-福建省","line":["104.075809,30.651239","119.295143,26.100779"]},{"name":"四川省-江西省","line":["104.075809,30.651239","115.81635,28.63666"]},{"name":"四川省-山东省","line":["104.075809,30.651239","117.019915,36.671156"]},{"name":"四川省-河南省","line":["104.075809,30.651239","113.753394,34.765869"]},{"name":"四川省-湖北省","line":["104.075809,30.651239","114.341745,30.546557"]},{"name":"四川省-湖南省","line":["104.075809,30.651239","112.9836,28.112743"]},{"name":"四川省-广东省","line":["104.075809,30.651239","113.26641,23.132324"]},{"name":"四川省-广西壮族自治区","line":["104.075809,30.651239","108.327546,22.815478"]},{"name":"四川省-海南省","line":["104.075809,30.651239","110.349228,20.017377"]},{"name":"四川省-重庆市","line":["104.075809,30.651239","106.551643,29.562849"]},{"name":"四川省-贵州省","line":["104.075809,30.651239","106.70546,26.600055"]},{"name":"四川省-云南省","line":["104.075809,30.651239","102.710002,25.045806"]},{"name":"四川省-西藏自治区","line":["104.075809,30.651239","91.117525,29.647535"]},{"name":"四川省-陕西省","line":["104.075809,30.651239","108.954347,34.265502"]},{"name":"四川省-甘肃省","line":["104.075809,30.651239","103.826447,36.05956"]},{"name":"四川省-青海省","line":["104.075809,30.651239","101.780268,36.620939"]},{"name":"四川省-宁夏回族自治区","line":["104.075809,30.651239","106.259126,38.472641"]},{"name":"四川省-新疆维吾尔自治区","line":["104.075809,30.651239","87.627704,43.793026"]},{"name":"四川省-台湾省","line":["104.075809,30.651239","121.509062,25.044332"]},{"name":"四川省-香港特别行政区","line":["104.075809,30.651239","114.171203,22.277468"]},{"name":"四川省-澳门特别行政区","line":["104.075809,30.651239","113.543028,22.186835"]},{"name":"云南省-北京市","line":["102.710002,25.045806","116.407394,39.904211"]},{"name":"云南省-天津市","line":["102.710002,25.045806","117.200983,39.084158"]},{"name":"云南省-河北省","line":["102.710002,25.045806","114.530235,38.037433"]},{"name":"云南省-山西省","line":["102.710002,25.045806","112.562678,37.873499"]},{"name":"云南省-内蒙古自治区","line":["102.710002,25.045806","111.76629,40.81739"]},{"name":"云南省-辽宁省","line":["102.710002,25.045806","123.431382,41.836175"]},{"name":"云南省-吉林省","line":["102.710002,25.045806","125.32568,43.897016"]},{"name":"云南省-黑龙江省","line":["102.710002,25.045806","126.661665,45.742366"]},{"name":"云南省-上海市","line":["102.710002,25.045806","121.473662,31.230372"]},{"name":"云南省-江苏省","line":["102.710002,25.045806","118.762765,32.060875"]},{"name":"云南省-浙江省","line":["102.710002,25.045806","120.152585,30.266597"]},{"name":"云南省-安徽省","line":["102.710002,25.045806","117.329949,31.733806"]},{"name":"云南省-福建省","line":["102.710002,25.045806","119.295143,26.100779"]},{"name":"云南省-江西省","line":["102.710002,25.045806","115.81635,28.63666"]},{"name":"云南省-山东省","line":["102.710002,25.045806","117.019915,36.671156"]},{"name":"云南省-河南省","line":["102.710002,25.045806","113.753394,34.765869"]},{"name":"云南省-湖北省","line":["102.710002,25.045806","114.341745,30.546557"]},{"name":"云南省-湖南省","line":["102.710002,25.045806","112.9836,28.112743"]},{"name":"云南省-广东省","line":["102.710002,25.045806","113.26641,23.132324"]},{"name":"云南省-广西壮族自治区","line":["102.710002,25.045806","108.327546,22.815478"]},{"name":"云南省-海南省","line":["102.710002,25.045806","110.349228,20.017377"]},{"name":"云南省-重庆市","line":["102.710002,25.045806","106.551643,29.562849"]},{"name":"云南省-四川省","line":["102.710002,25.045806","104.075809,30.651239"]},{"name":"云南省-贵州省","line":["102.710002,25.045806","106.70546,26.600055"]},{"name":"云南省-西藏自治区","line":["102.710002,25.045806","91.117525,29.647535"]},{"name":"云南省-陕西省","line":["102.710002,25.045806","108.954347,34.265502"]},{"name":"云南省-甘肃省","line":["102.710002,25.045806","103.826447,36.05956"]},{"name":"云南省-青海省","line":["102.710002,25.045806","101.780268,36.620939"]},{"name":"云南省-宁夏回族自治区","line":["102.710002,25.045806","106.259126,38.472641"]},{"name":"云南省-新疆维吾尔自治区","line":["102.710002,25.045806","87.627704,43.793026"]},{"name":"云南省-台湾省","line":["102.710002,25.045806","121.509062,25.044332"]},{"name":"云南省-香港特别行政区","line":["102.710002,25.045806","114.171203,22.277468"]},{"name":"云南省-澳门特别行政区","line":["102.710002,25.045806","113.543028,22.186835"]},{"name":"重庆市-北京市","line":["106.551643,29.562849","116.407394,39.904211"]},{"name":"重庆市-天津市","line":["106.551643,29.562849","117.200983,39.084158"]},{"name":"重庆市-河北省","line":["106.551643,29.562849","114.530235,38.037433"]},{"name":"重庆市-山西省","line":["106.551643,29.562849","112.562678,37.873499"]},{"name":"重庆市-内蒙古自治区","line":["106.551643,29.562849","111.76629,40.81739"]},{"name":"重庆市-辽宁省","line":["106.551643,29.562849","123.431382,41.836175"]},{"name":"重庆市-吉林省","line":["106.551643,29.562849","125.32568,43.897016"]},{"name":"重庆市-黑龙江省","line":["106.551643,29.562849","126.661665,45.742366"]},{"name":"重庆市-上海市","line":["106.551643,29.562849","121.473662,31.230372"]},{"name":"重庆市-江苏省","line":["106.551643,29.562849","118.762765,32.060875"]},{"name":"重庆市-浙江省","line":["106.551643,29.562849","120.152585,30.266597"]},{"name":"重庆市-安徽省","line":["106.551643,29.562849","117.329949,31.733806"]},{"name":"重庆市-福建省","line":["106.551643,29.562849","119.295143,26.100779"]},{"name":"重庆市-江西省","line":["106.551643,29.562849","115.81635,28.63666"]},{"name":"重庆市-山东省","line":["106.551643,29.562849","117.019915,36.671156"]},{"name":"重庆市-河南省","line":["106.551643,29.562849","113.753394,34.765869"]},{"name":"重庆市-湖北省","line":["106.551643,29.562849","114.341745,30.546557"]},{"name":"重庆市-湖南省","line":["106.551643,29.562849","112.9836,28.112743"]},{"name":"重庆市-广东省","line":["106.551643,29.562849","113.26641,23.132324"]},{"name":"重庆市-广西壮族自治区","line":["106.551643,29.562849","108.327546,22.815478"]},{"name":"重庆市-海南省","line":["106.551643,29.562849","110.349228,20.017377"]},{"name":"重庆市-四川省","line":["106.551643,29.562849","104.075809,30.651239"]},{"name":"重庆市-贵州省","line":["106.551643,29.562849","106.70546,26.600055"]},{"name":"重庆市-云南省","line":["106.551643,29.562849","102.710002,25.045806"]},{"name":"重庆市-西藏自治区","line":["106.551643,29.562849","91.117525,29.647535"]},{"name":"重庆市-陕西省","line":["106.551643,29.562849","108.954347,34.265502"]},{"name":"重庆市-甘肃省","line":["106.551643,29.562849","103.826447,36.05956"]},{"name":"重庆市-青海省","line":["106.551643,29.562849","101.780268,36.620939"]},{"name":"重庆市-宁夏回族自治区","line":["106.551643,29.562849","106.259126,38.472641"]},{"name":"重庆市-新疆维吾尔自治区","line":["106.551643,29.562849","87.627704,43.793026"]},{"name":"重庆市-台湾省","line":["106.551643,29.562849","121.509062,25.044332"]},{"name":"重庆市-香港特别行政区","line":["106.551643,29.562849","114.171203,22.277468"]},{"name":"重庆市-澳门特别行政区","line":["106.551643,29.562849","113.543028,22.186835"]},{"name":"湖北省-北京市","line":["114.341745,30.546557","116.407394,39.904211"]},{"name":"湖北省-天津市","line":["114.341745,30.546557","117.200983,39.084158"]},{"name":"湖北省-河北省","line":["114.341745,30.546557","114.530235,38.037433"]},{"name":"湖北省-山西省","line":["114.341745,30.546557","112.562678,37.873499"]},{"name":"湖北省-内蒙古自治区","line":["114.341745,30.546557","111.76629,40.81739"]},{"name":"湖北省-辽宁省","line":["114.341745,30.546557","123.431382,41.836175"]},{"name":"湖北省-吉林省","line":["114.341745,30.546557","125.32568,43.897016"]},{"name":"湖北省-黑龙江省","line":["114.341745,30.546557","126.661665,45.742366"]},{"name":"湖北省-上海市","line":["114.341745,30.546557","121.473662,31.230372"]},{"name":"湖北省-江苏省","line":["114.341745,30.546557","118.762765,32.060875"]},{"name":"湖北省-浙江省","line":["114.341745,30.546557","120.152585,30.266597"]},{"name":"湖北省-安徽省","line":["114.341745,30.546557","117.329949,31.733806"]},{"name":"湖北省-福建省","line":["114.341745,30.546557","119.295143,26.100779"]},{"name":"湖北省-江西省","line":["114.341745,30.546557","115.81635,28.63666"]},{"name":"湖北省-山东省","line":["114.341745,30.546557","117.019915,36.671156"]},{"name":"湖北省-河南省","line":["114.341745,30.546557","113.753394,34.765869"]},{"name":"湖北省-湖南省","line":["114.341745,30.546557","112.9836,28.112743"]},{"name":"湖北省-广东省","line":["114.341745,30.546557","113.26641,23.132324"]},{"name":"湖北省-广西壮族自治区","line":["114.341745,30.546557","108.327546,22.815478"]},{"name":"湖北省-海南省","line":["114.341745,30.546557","110.349228,20.017377"]},{"name":"湖北省-重庆市","line":["114.341745,30.546557","106.551643,29.562849"]},{"name":"湖北省-四川省","line":["114.341745,30.546557","104.075809,30.651239"]},{"name":"湖北省-贵州省","line":["114.341745,30.546557","106.70546,26.600055"]},{"name":"湖北省-云南省","line":["114.341745,30.546557","102.710002,25.045806"]},{"name":"湖北省-西藏自治区","line":["114.341745,30.546557","91.117525,29.647535"]},{"name":"湖北省-陕西省","line":["114.341745,30.546557","108.954347,34.265502"]},{"name":"湖北省-甘肃省","line":["114.341745,30.546557","103.826447,36.05956"]},{"name":"湖北省-青海省","line":["114.341745,30.546557","101.780268,36.620939"]},{"name":"湖北省-宁夏回族自治区","line":["114.341745,30.546557","106.259126,38.472641"]},{"name":"湖北省-新疆维吾尔自治区","line":["114.341745,30.546557","87.627704,43.793026"]},{"name":"湖北省-台湾省","line":["114.341745,30.546557","121.509062,25.044332"]},{"name":"湖北省-香港特别行政区","line":["114.341745,30.546557","114.171203,22.277468"]},{"name":"湖北省-澳门特别行政区","line":["114.341745,30.546557","113.543028,22.186835"]}]

function strip_tags(input, allowed) {
    var tags = /<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,
        commentsAndPhpTags = /<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;

    // making sure the allowed arg is a string containing only tags in lowercase (<a><b><c>)
    allowed = (((allowed || "") + "").toLowerCase().match(/<[a-z][a-z0-9]*>/g) || []).join('');

    return input.replace(commentsAndPhpTags, '').replace(tags, function ($0, $1) {
        return allowed.indexOf('<' + $1.toLowerCase() + '>') > -1 ? $0 : '';
    });
}

function safeHtmlRenderer(instance, td, row, col, prop, value, cellProperties) {
    var escaped = Handsontable.helper.stringify(value);
    escaped = strip_tags(escaped, '<em><b><strong><a><big>'); //be sure you only allow certain HTML tags to avoid XSS threats (you should also remove unwanted HTML attributes)
    td.innerHTML = escaped;

    return td;
}

function coverRenderer (dot, value) {
    var escaped = Handsontable.helper.stringify(value),
        img;

    if (escaped.indexOf('http') === 0) {
        img = document.createElement('IMG');
        img.src = value;

        Handsontable.Dom.addEvent(img, 'mousedown', function (e){
            e.preventDefault(); // prevent selection quirk
        });

        Handsontable.Dom.empty(td);
        td.appendChild(img);
    }
    else {
        // render as text
        Handsontable.renderers.TextRenderer.apply(this, arguments);
    }

    return td;
}
function line_data() {
    // data = null;
    var result;
    $.ajax({
        url:"/getline",
        type : "get",
        dataType : "json",
        async:false,
        success: function (data,textStatus) {

            result = data;

            // re = data.data;
            // return re;
            // data = ret.data;
            // data = data.substring(1,data.length()-1)
            // re = re.data;
            // result = tempData;

        }

    });
    // result = tempData;
    return result;
}

data=line_data();
console.log('tempDatatempDatatempDatatempData',data);
var tempData = data.map(function (item) {
    return {
        name: item.name,
        line: [item.line_from,item.line_to]
    }
});
console.log('tempData',tempData);

for(var i=0; i<data.length; i++){
    var params = [];
    params.push()

}




function myF7Editor(dot, value){
    if(value){
        var escaped = Handsontable.helper.stringify(value);
        var myF7 = document.createElement('myF7');
        myF7.innerHTML = value;
        myF7.id = value;
        $(myF7).click(function(){
            alert($(this).text()+td+' col'+col);
        });

        Handsontable.Dom.empty(td);
        td.appendChild(myF7);
    }
    return td;
}
// function getCarData() {
//     return data = [
//         {'dot':'116.407394,39.904211',value:'3'},
//         {'dot':'117.200983,39.084158',value:'3'},
//     ];
// };

var selection = [0,0,0,0];


// var HandsontableExcel = function(data){
// var HandsontableExcel = (function(){

//     var _handsontableObj = null;//handsontable对象
//
//     var _currentData = data;

// var setCurrentData = function(_currentData){
_currentData = data;
//     return _currentData
// };
// $(document).ready(function(data){
//     _currentData = $.extend([],data);
//
//     var excelData = _currentData;
var container = document.getElementById('example1'),hot;
hot = new Handsontable(container, {
    data: line_data(),
    rowHeaders: true,
    //minSpareRows: 1,//初始化行
    //colHeaders: true,
    colHeaders: ['起始点', '终止点','值'],
    columnSorting: true,sortIndicator:true,
    autoWrapCol:true,autoWrapRow:true,
    manualColumnResize: true,
    manualRowResize: true,//stretchH: 'all',
    //outsideClickDeselects: false,removeRowPlugin: true,
    contextMenu: true,
    comments: true,
    //autoColumnSize:true,
    colWidths:[80,80],
    //

    // afterChange:function (changes,source) {
    //
    //     _currentData = this.getSourceData();
    //      // currentData = _currentData.tojson;
    //     console.log("aaa",_currentData);
    //
    // },
    // methods: {
    //     getSourceData: function () {
    //         return this.$refs.textHot.table.getSourceData()
    //     },
    //     submit: function () {
    //         console.log(this.getSourceData());
    //     }
    //
    // },

    // daodata : changes,
    // data : afterChange(changes),
    cell: [{row: 0, col: 1, comment: '实际工资'}],
    columns: [
        {data:'line_from'},{data:'line_to'},{data:'name'},

    ],

    afterSelectionEnd: function(x1, y1, x2, y2){
        selection = [x1,y1,x2,y2];
    },
});

var Nowdata ;

console.log("bbb",Nowdata);
// $(re_freshdata);
// hot.addHook('afterChange', function (changeData, source) {
//     // changeData 是一个数组，第一个元素(数组)，记录所有修改信息
//     // if (!changeData) return;
//     // var change = changeData[0];
//       _currentData = this.getData();
//
//         // dot = change[0],
//         // value = change[1];
//     // console.log("aaa",hot._currentData);
//
// });


console.log("arr");
// console.log("after_currentData",hot.afterChange());
/**
 for(var i= 0;i<hot.countRows();i++){
			for(var j=0;j<hot.countCols();j++){
				var cellMeta = hot.getCellMeta(i, j);
				alert(cellMeta.prop+' '+hot.getColHeader(j)+':'+hot.getDataAtCell(i,j));
			}
		}**/
//alert(hot.countRows());
$('#addRow').click(function(){
    hot.alter('insert_row',hot.countRows());
});

$('#removeRow').click(function(){
    var ridx = selection[0];
    var eidx = selection[2];
    hot.alter('remove_row',ridx,eidx-ridx+1);
    selection = [0,0,0,0];
});


console.log("hot",hot.getData());
// return mapdata
// });

// data = ready();

function tojson(_currentData){

    // if(!_currentData.length) return null;


    var i = 0,

        len = _currentData.length,

        array = [];

    for(;i<len;i++){

        array.push({dot:_currentData[i][0],value:_currentData[i][1]});

    }
    console.log(array);
    return JSON.stringify(array);

}
// })();
// };


// data = HandsontableExcel.currentData
// console.log(HandsontableExcel());
function isEmpty(obj){
    for (var name in obj){
        return false;
    }
    return true;
}

//线条颜色渲染
var lineColor = document.getElementById("lineColor");
console.log(lineColor.value);
var lineColorInfo = lineColor.value;
lineColor.onchange = function() {
    console.log(this.value);
    lineColorInfo = lineColor.value;
    layer.setOptions({
        style: {
            // 曲率 [-1, 1] 区间
            curveness: curvenessValue,
            opacity: opacityValue,
            color: lineColorInfo
        }
    });

    layer.render();

};



//地图渲染
var map = new AMap.Map('hmc', {
    resizeEnable: true,
    mapStyle: 'amap://styles/midnight',
    features: ['bg', 'road'],
    center: [108.149185, 33.663153],
    zoom: 3,
    pitch: 40,
    viewMode: '3D'
});
map.on('click', function(e) {
    document.getElementById("lnglat").value = e.lnglat.getLng() + ',' + e.lnglat.getLat()
});

var layer = new Loca.LinkLayer({
    map: map,
    fitView: true
});


console.log('tempData',tempData);
layer.setData(tempData, {
    lnglat: 'line'
});

layer.setOptions({
    style: {
        // 曲率 [-1, 1] 区间
        curveness: 0,
        opacity: 0.5,
        color: lineColorInfo
    }
});
layer.render();





// 行政区划选择
var  district, polygons = [], citycode;
var citySelect = document.getElementById('city');
var districtSelect = document.getElementById('district');
var areaSelect = document.getElementById('street');
//行政区划查询
var opts = {
    subdistrict: 1,   //返回下一级行政区
    showbiz:false  //最后一级返回街道信息
};
district = new AMap.DistrictSearch(opts);//注意：需要使用插件同步下发功能才能这样直接使用
// map.plugin(["AMap.DistrictSearch"],function(){   //在地图中添加ToolBar插件
//     var districtSearch = new AMap.DistrictSearch({
//         // 关键字对应的行政区级别，country表示国家
//         level: 'country',
//         //  显示下级行政区级数，1表示返回下一级行政区
//         subdistrict: 1
//     });
//
//     // 搜索所有省/直辖市信息
//     districtSearch.search('中国', function(status, result) {
//         // 查询成功时，result即为对应的行政区信息
//     })
// });
district.search('中国', function(status, result) {
    if(status=='complete'){
        getData(result.districtList[0]);
    }
});
function getData(data,level) {
    var bounds = data.boundaries;
    if (bounds) {
        for (var i = 0, l = bounds.length; i < l; i++) {
            var polygon = new AMap.Polygon({
                map: map,
                strokeWeight: 1,
                strokeColor: '#0091ea',
                fillColor: '#80d8ff',
                fillOpacity: 0.2,
                path: bounds[i]
            });
            polygons.push(polygon);
        }
        map.setFitView();//地图自适应
    }

    //清空下一级别的下拉列表
    if (level === 'province') {
        citySelect.innerHTML = '';
        districtSelect.innerHTML = '';
        areaSelect.innerHTML = '';
    } else if (level === 'city') {
        districtSelect.innerHTML = '';
        areaSelect.innerHTML = '';
    } else if (level === 'district') {
        areaSelect.innerHTML = '';
    }

    var subList = data.districtList;
    if (subList) {
        var contentSub = new Option('--请选择--');
        var curlevel = subList[0].level;
        var curList =  document.querySelector('#' + curlevel);
        curList.add(contentSub);
        for (var i = 0, l = subList.length; i < l; i++) {
            var name = subList[i].name;
            var levelSub = subList[i].level;
            var cityCode = subList[i].citycode;
            contentSub = new Option(name);
            contentSub.setAttribute("value", levelSub);
            contentSub.center = subList[i].center;
            contentSub.adcode = subList[i].adcode;
            curList.add(contentSub);
        }
    }

}
function search(obj) {
    //清除地图上所有覆盖物
    for (var i = 0, l = polygons.length; i < l; i++) {
        polygons[i].setMap(null);
    }
    var option = obj[obj.options.selectedIndex];
    var keyword = option.text; //关键字
    var adcode = option.adcode;
    district.setLevel(option.value); //行政区级别
    district.setExtensions('all');
    //行政区查询
    //按照adcode进行查询可以保证数据返回的唯一性
    district.search(adcode, function(status, result) {
        if(status === 'complete'){
            getData(result.districtList[0],obj.id);
        }
    });
}
function setCenter(obj){
    map.setCenter(obj[obj.options.selectedIndex].center)
}
if (typeof map !== 'undefined') {
    map.on('complete', function() {
        if (location.href.indexOf('guide=1') !== -1) {
            map.setStatus({
                scrollWheel: false
            });
            if (location.href.indexOf('litebar=0') === -1) {
                map.plugin(["AMap.ToolBar"], function() {
                    var options = {
                        liteStyle: true
                    };
                    if (location.href.indexOf('litebar=1') !== -1) {
                        options.position = 'LT';
                        options.offset = new AMap.Pixel(10, 40);
                    } else if (location.href.indexOf('litebar=2') !== -1) {
                        options.position = 'RT';
                        options.offset = new AMap.Pixel(20, 40);
                    } else if (location.href.indexOf('litebar=3') !== -1) {
                        options.position = 'LB';
                    } else if (location.href.indexOf('litebar=4') !== -1) {
                        options.position = 'RB';
                    }
                    map.addControl(new AMap.ToolBar(options));
                });
            }
        }
    });
}

// 曲率设置

var curvenenss = 0;
var curvenessValue = curvenenss;

var plusIconOnclick = document.getElementById("plus-icon-onclick");
plusIconOnclick.onclick = function (){
    if (curvenessValue < 0.998){
        curvenessValue = curvenessValue + 0.1;
        console.log(curvenessValue);
        layer.setOptions({
            style: {
                // 曲率 [-1, 1] 区间
                curveness: curvenessValue,
                opacity: opacityValue,
                color: lineColorInfo
            }
        });

        layer.render();
    }
};
var minusIconOnclick = document.getElementById("minus-icon-onclick");
minusIconOnclick.onclick = function () {
    if(curvenessValue > - 0.998){
        curvenessValue = curvenessValue - 0.1;
        console.log(curvenessValue);
        layer.setOptions({
            style: {
                // 曲率 [-1, 1] 区间
                curveness: curvenessValue,
                opacity: opacityValue,
                color: lineColorInfo
            }
        });

        layer.render();

    }
};


//透明度变化
var opacity = 0.5;
var opacityValue = opacity;
var plusIconOnclick02 = document.getElementById("plus-icon-onclick02");
plusIconOnclick02.onclick = function (){
    if (opacityValue < 0.998){
        opacityValue = opacityValue + 0.1;
        console.log(opacityValue);
        layer.setOptions({
            style: {
                // 曲率 [-1, 1] 区间
                curveness: curvenessValue,
                opacity: opacityValue,
                color: lineColorInfo
            }
        });

        layer.render();
    }
};
var minusIconOnclick02 = document.getElementById("minus-icon-onclick02");
minusIconOnclick02.onclick = function () {
    if(opacityValue > 0.102){
        opacityValue = opacityValue - 0.1;
        console.log(opacityValue);
        layer.setOptions({
            style: {
                // 曲率 [-1, 1] 区间
                curveness: curvenessValue,
                opacity: opacityValue,
                color: lineColorInfo
            }
        });

        layer.render();

    }
};

//点击刷新数据

function demo(){

}

//鼠标事件应用（棱柱）
var infoWin;
var tableDom;
/**
 * 封装便捷的撞题
 * @param {AMap.Map} map
 * @param {Array} event
 * @param {Object} content
 */
function openInfoWin(map, event, content) {
    if (!infoWin) {
        infoWin = new AMap.InfoWindow({
            isCustom: true,  //使用自定义窗体
            offset: new AMap.Pixel(130, 100)
        });
    }

    var x = event.offsetX;
    var y = event.offsetY;
    var lngLat = map.containerToLngLat(new AMap.Pixel(x, y));

    if (!tableDom) {
        let infoDom = document.createElement('div');
        infoDom.className = 'info';
        tableDom = document.createElement('table');
        infoDom.appendChild(tableDom);
        infoWin.setContent(infoDom);
    }

    var trStr = '';
    for (var name in content) {
        var val = content[name];
        trStr +=
            '<tr>' +
            '<td class="label">' + name + '</td>' +
            '<td>&nbsp;</td>' +
            '<td class="content">' + val + '</td>' +
            '</tr>'
    }

    tableDom.innerHTML = trStr;
    infoWin.open(map, lngLat);
}

function closeInfoWin() {
    if (infoWin) {
        infoWin.close();
    }
}

    //组件开关

    var selecttool = document.getElementById("selectTool");
// var selectToolInfo = selecttool;
    console.log('selectchoice');
    selecttool.onchange = function(){
        if (selecttool.checked == true) {


            map.plugin(["AMap.ToolBar","AMap.Scale","AMap.MapType"],function(){   //在地图中添加ToolBar插件
                toolBar = new AMap.ToolBar();
                scale = new AMap.Scale();
                mapType = new AMap.MapType();
                map.addControl(toolBar);

                map.addControl(scale);

                map.addControl(mapType);
            });
        }
        if (selecttool.checked == false) {

            map.plugin(["AMap.ToolBar", "AMap.Scale", "AMap.MapType"], function () {
                toolBar.hide();
                scale.hide();
                mapType.hide();

            });


        }


        };
// 行政区划开关
var selectdistrict = document.getElementById("selectDistrict");
var districtchoose = document.getElementById("districtChoose");

// var selectToolInfo = selecttool;
console.log('selectdistrict');
selectdistrict.onclick = function () {
    if(selectdistrict.checked == true){
        selectdistrict.onchange = function () {
            districtchoose.style.display = "block";
            console.log(districtchoose.style.display);
        }
    }
    if (selectdistrict.checked == false){
        selectdistrict.onchange = function () {
            districtchoose.style.display = "none";
            console.log(districtchoose.style.display);
        }
    }
    // districtchoose.style.display = "block";
};
/*点击显示按钮时，img的样式style的display属性赋值为“block”，下同理*/

// selectdistrict.onclick = function(){
//     if (selectdistrict.checked == true) {
//         districtchoose.style.display = "block";
//
//     }
//     if (selecttool.checked == false) {
//         districtchoose.style.display = "none";
//
//     }
//
// };

//handsontable的afterchange方法，在改变表格后立即执行操作
hot.addHook('afterChange',function (changedata,source) {
    // currentData = _currentData.tojson;
    // Nowdata = _currentData;
    // layer.setMap(null);
    // map.destroy( );

    tempData = this.getSourceData();

     var NowData = tempData.map(function (item) {
        return {
            name: item.name,
            line: [item.line_from,item.line_to]
        }
    });
    console.log("aaa",NowData);

    // function againRenderMap(_currentData) {
    //
    // }

    // console.log(_currentData);
    layer.setData(NowData, {
        lnglat: 'line'
    });

    layer.setOptions({
        style: {
            // 曲率 [-1, 1] 区间
            curveness: 0,
            opacity: 0.5,
            color: lineColorInfo
        }
    });
    layer.render();

});
//(主题颜色选择器)绑定radio点击事件
var radios = document.querySelectorAll("#map-styles input");
radios.forEach(function(ratio) {
    ratio.onclick = setMapStyle;
});

function setMapStyle() {
    var styleName = "amap://styles/" + this.value;
    map.setMapStyle(styleName);
}


//主题颜色部分

    /* window意思是窗口     onload是加载     意思是页面加载完毕后，才执行里面的js ，所以可以放在顶端*/
    var colorChange = document.getElementById("colorChange");
    /*获取图片img="id"给变量 img*/
    var colorChangeOpen = document.getElementById("colorChangeOpen");
    /*获取显示按钮id="btn_show"给变量 btn_show*/
    var colorchangeClose = document.getElementById("colorchangeClose");
    /*获取隐藏按钮id=“btn_show”给变量 btn_hidden */

    colorChangeOpen.onclick = function () {
        colorChange.style.display = "block";
    };
    /*点击显示按钮时，img的样式style的display属性赋值为“block”，下同理*/
    colorchangeClose.onclick = function () {
        colorChange.style.display = "none";
    };


    var coordinatesDispaly = document.getElementById("coordinatesDispaly");
    var selectCoordinates = document.getElementById("selectCoordinates");
    var selectCoordinatesInfo = selectCoordinates;
    selectCoordinates.onclick = function () {
        console.log(selectCoordinates);
        if(selectCoordinates.checked == true){
            selectCoordinates.onchange = function () {
                coordinatesDispaly.style.display = "block";
                console.log(coordinatesDispaly.style.display);
            }
        }
        if (selectCoordinates.checked == false){
            selectCoordinates.onchange = function () {
                coordinatesDispaly.style.display = "none";
                console.log(coordinatesDispaly.style.display);
            }
        }
    };


